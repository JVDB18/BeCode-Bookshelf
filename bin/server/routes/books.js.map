{"version":3,"sources":["../../../src/server/routes/books.js"],"names":["router","express","Router","all","authMiddleware","get","req","res","console","log","method","toUpperCase","url","Books","find","then","books","json","catch","error","send","findOne","_id","params","book","post","body","title","author","isbn","language","format","created_at","Date","now","updated_at","create","result","put","options","new","findOneAndUpdate","delete","findOneAndDelete","Borroweds","book_id","borrows","Reviews","reviews","module","exports"],"mappings":"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","sourcesContent":["/* becodeorg/bookshelf\r\n *\r\n * /src/server/routes/books.js - Books Router\r\n *\r\n * coded by Tanguy@Team Noix\r\n * started at 13/02/2019\r\n */\r\n\r\nimport express from \"express\";\r\nimport {authMiddleware} from \"../authentication.js\";\r\nconst router = new express.Router();\r\n\r\n// Import Mongoose Model\r\nimport Books from \"../models/Books.js\";\r\nimport Borroweds from \"../models/Borroweds.js\";\r\nimport Reviews from \"../models/Reviews.js\";\r\n\r\n// Require Authentication on all routes\r\nrouter.all(\"*\", authMiddleware);\r\n\r\nrouter.get(\"/\", (req, res) => {\r\n    // Books index\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    Books.find()\r\n        .then(books => {\r\n            res.json(books);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\nrouter.get(\"/:book\", (req, res) => {\r\n    // Books Show\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    Books.findOne({_id: req.params.book})\r\n        .then(book => {\r\n            res.json(book);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\nrouter.post(\"/\", (req, res) => {\r\n    // Books Store\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    if (!req.body.title || !req.body.author || !req.body.isbn) {\r\n        console.log(\"Missing informations to create book\");\r\n        res.send(\"Missing informations to create book\");\r\n        return;\r\n    }\r\n\r\n    const book = {\r\n        title: req.body.title,\r\n        author: req.body.author,\r\n        isbn: req.body.isbn,\r\n        language: req.body.language ? req.body.language : null,\r\n        format: req.body.format ? req.body.format : null,\r\n        created_at: Date.now(),\r\n        updated_at: null,\r\n    };\r\n\r\n    Books.create(book)\r\n        .then(result => {\r\n            console.log(`\\\"${result.title}\\\" saved to database.`);\r\n            res.json(result);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\n/*\r\nrouter.get(\"/:book/edit\", (req, res) => {\r\n    // Books Edit\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    Books.findOne({_id: req.params.book})\r\n        .then(book => {\r\n            res.json(book);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n*/\r\n\r\nrouter.put(\"/:book\", (req, res) => {\r\n    // Book Update\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    if (!req.body.title || !req.body.author || !req.body.isbn) {\r\n        console.log(\"Missing informations to update book\");\r\n        res.send(\"Missing informations to update book\");\r\n        return;\r\n    }\r\n\r\n    const book = {\r\n        title: req.body.title,\r\n        author: req.body.author,\r\n        isbn: req.body.isbn,\r\n        language: req.body.language ? req.body.language : null,\r\n        format: req.body.format ? req.body.format : null,\r\n        updated_at: Date.now(),\r\n    };\r\n\r\n    const options = {\r\n        new: true,\r\n    };\r\n\r\n    Books.findOneAndUpdate(\r\n        {_id: req.params.book},\r\n        book,\r\n        options,\r\n        (error, result) => {\r\n            if (error) {\r\n                console.error(error);\r\n                res.send(error);\r\n                return;\r\n            }\r\n            console.log(`\\\"${result.title}\\\" updated in database`);\r\n            res.json(result);\r\n        },\r\n    );\r\n});\r\n\r\nrouter.delete(\"/:book\", (req, res) => {\r\n    // Users Delete\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    Books.findOneAndDelete({_id: req.params.book}, (error, result) => {\r\n        if (error) {\r\n            console.error(error);\r\n            res.send(error);\r\n            return;\r\n        }\r\n\r\n        if (result === null) {\r\n            console.error(\"Book not found\");\r\n            res.send(\"Book not found\");\r\n            return;\r\n        }\r\n\r\n        console.log(`\\\"${result.title}\\\" deleted from database`);\r\n        res.send(`\\\"${result.title}\\\" deleted from database`);\r\n    });\r\n});\r\n\r\nrouter.get(\"/:book/borroweds\", (req, res) => {\r\n    // Books' Borroweds Index\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/books${req.url}`);\r\n\r\n    Borroweds.find({book_id: req.params.book}, (error, borrows) => {\r\n        if (error) {\r\n            console.error(error);\r\n            res.send(error);\r\n            return;\r\n        }\r\n        res.json(borrows);\r\n    });\r\n});\r\n\r\nrouter.get(\"/:book/reviews\", (req, res) => {\r\n    // Book's Reviews Index\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/users${req.url}`);\r\n\r\n    Reviews.find({book_id: req.params.book}, (error, reviews) => {\r\n        if (error) {\r\n            console.error(error);\r\n            res.send(error);\r\n            return;\r\n        }\r\n        res.json(reviews);\r\n    });\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"books.js"}