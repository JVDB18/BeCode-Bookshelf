{"version":3,"sources":["../../../src/server/routes/borroweds.js"],"names":["router","express","Router","all","authMiddleware","get","req","res","console","log","method","toUpperCase","url","Borroweds","find","then","borroweds","json","catch","error","send","findOne","_id","params","borrowed","post","body","user_id","book_id","mongoose","Types","ObjectId","borrowed_date","Date","now","returned_date","create","result","put","options","new","Reviews","findOneAndUpdate","module","exports"],"mappings":"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","sourcesContent":["/* becodeorg/bookshelf\r\n *\r\n * /src/server/routes/books.js - Books Router\r\n *\r\n * coded by Tanguy@Team Noix\r\n * started at 13/02/2019\r\n */\r\n\r\nimport mongoose from \"mongoose\";\r\nimport express from \"express\";\r\nimport {authMiddleware} from \"../authentication.js\";\r\nconst router = new express.Router();\r\n\r\n// Import Mongoose Model\r\nimport Borroweds from \"../models/Borroweds.js\";\r\n\r\n// Require Authentication on all routes\r\nrouter.all(\"*\", authMiddleware);\r\n\r\nrouter.get(\"/\", (req, res) => {\r\n    // Borroweds Index\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/borroweds${req.url}`);\r\n\r\n    Borroweds.find()\r\n        .then(borroweds => {\r\n            res.json(borroweds);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\nrouter.get(\"/:borrowed\", (req, res) => {\r\n    // Borroweds Show\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/borroweds${req.url}`);\r\n\r\n    Borroweds.findOne({_id: req.params.borrowed})\r\n        .then(borrowed => {\r\n            res.json(borrowed);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\nrouter.post(\"/\", (req, res) => {\r\n    // Borroweds Store\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/borroweds${req.url}`);\r\n\r\n    if (!req.body.user_id || !req.body.book_id) {\r\n        console.log(\"Missing informations to borrow book\");\r\n        res.send(\"Missing informations to borrow book\");\r\n        return;\r\n    }\r\n\r\n    const borrowed = {\r\n        user_id: new mongoose.Types.ObjectId(req.body.user_id),\r\n        book_id: new mongoose.Types.ObjectId(req.body.book_id),\r\n        borrowed_date: Date.now(),\r\n        returned_date: null,\r\n    };\r\n\r\n    Borroweds.create(borrowed)\r\n        .then(result => {\r\n            console.log(\"Book borrowing saved to database.\");\r\n            res.json(result);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\n/*\r\nrouter.get(\"/:borrowed/edit\", (req, res) => {\r\n    // Borroweds Edit\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/borroweds${req.url}`);\r\n\r\n    Borroweds.findOne({_id: req.params.borrowed})\r\n        .then(borrowed => {\r\n            res.json(borrowed);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n*/\r\n\r\nrouter.put(\"/:borrowed\", (req, res) => {\r\n    // Borroweds Update\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/borroweds${req.url}`);\r\n\r\n    if (!req.body.user_id || !req.body.book_id || !req.body.borrowed_date) {\r\n        console.log(\"Missing informations to update book borrowing\");\r\n        res.send(\"Missing informations to update book borrowing\");\r\n        return;\r\n    }\r\n\r\n    const borrowed = {\r\n        user_id: new mongoose.Types.ObjectId(req.body.user_id),\r\n        book_id: new mongoose.Types.ObjectId(req.body.book_id),\r\n        borrowed_date: req.body.borrowed_date,\r\n        returned_date: req.body.returned_date ? req.body.returned_date : null,\r\n    };\r\n\r\n    const options = {\r\n        new: true,\r\n    };\r\n\r\n    Reviews.findOneAndUpdate(\r\n        {_id: req.params.borrowed},\r\n        borrowed,\r\n        options,\r\n        (error, result) => {\r\n            if (error) {\r\n                console.error(error);\r\n                res.send(error);\r\n                return;\r\n            }\r\n            console.log(\"Book borrowing updated in database\");\r\n            res.json(result);\r\n        },\r\n    );\r\n});\r\n\r\n/*\r\n * Not used in current app but, if it's needed, it's there and functionnal.\r\n * I know, I know, YAGNI - You Aren't Gonna Need It...\r\n * But hey ! It's called a CRUD, not a CRU !\r\n * And it's commented anyway, so it's not like it'll be a danger for historisation or something... right ?\r\n */\r\n/*\r\nrouter.delete(\"/:borrowed\", (req, res) => {\r\n    // Borroweds Delete\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/borroweds${req.url}`);\r\n\r\n    Borroweds.findOneAndDelete({_id: req.params.borrowed}, (error, result) => {\r\n        if (error) {\r\n            console.error(error);\r\n            res.send(error);\r\n            return;\r\n        }\r\n\r\n        if (result === null) {\r\n            console.error(\"Book borrowing not found\");\r\n            res.send(\"Book borrowing not found\");\r\n            return;\r\n        }\r\n\r\n        console.log(\"Book borrowing deleted from database\");\r\n        res.send(\"Book borrowing deleted from database\");\r\n    });\r\n});\r\n*/\r\n\r\nmodule.exports = router;\r\n"],"file":"borroweds.js"}