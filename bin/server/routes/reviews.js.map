{"version":3,"sources":["../../../src/server/routes/reviews.js"],"names":["router","express","Router","all","authMiddleware","get","req","res","console","log","method","toUpperCase","url","Reviews","find","then","reviews","json","catch","error","send","findOne","_id","params","review","post","body","user_id","book_id","stars","commentary","mongoose","Types","ObjectId","created_at","Date","now","updated_at","create","result","put","options","new","findOneAndUpdate","delete","findOneAndDelete","module","exports"],"mappings":"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","sourcesContent":["/* becodeorg/bookshelf\r\n *\r\n * /src/server/routes/books.js - Books Router\r\n *\r\n * coded by Tanguy@Team Noix\r\n * started at 13/02/2019\r\n */\r\n\r\nimport mongoose from \"mongoose\";\r\nimport express from \"express\";\r\nimport {authMiddleware} from \"../authentication.js\";\r\nconst router = new express.Router();\r\n\r\n// Import Mongoose Model\r\nimport Reviews from \"../models/Reviews.js\";\r\n\r\n// Require Authentication on all routes\r\nrouter.all(\"*\", authMiddleware);\r\n\r\nrouter.get(\"/\", (req, res) => {\r\n    // Reviews Index\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/reviews${req.url}`);\r\n\r\n    Reviews.find()\r\n        .then(reviews => {\r\n            res.json(reviews);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\nrouter.get(\"/:review\", (req, res) => {\r\n    // Reviews Show\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/reviews${req.url}`);\r\n\r\n    Reviews.findOne({_id: req.params.review})\r\n        .then(review => {\r\n            res.json(review);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\nrouter.post(\"/\", (req, res) => {\r\n    // Reviews Store\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/reviews${req.url}`);\r\n\r\n    if (\r\n        !req.body.user_id ||\r\n        !req.body.book_id ||\r\n        !req.body.stars ||\r\n        !req.body.commentary\r\n    ) {\r\n        console.log(\"Missing informations to create review\");\r\n        res.send(\"Missing informations to create review\");\r\n        return;\r\n    }\r\n\r\n    const review = {\r\n        user_id: new mongoose.Types.ObjectId(req.body.user_id),\r\n        book_id: new mongoose.Types.ObjectId(req.body.book_id),\r\n        stars: req.body.stars,\r\n        commentary: req.body.commentary,\r\n        created_at: Date.now(),\r\n        updated_at: null,\r\n    };\r\n\r\n    Reviews.create(review)\r\n        .then(result => {\r\n            console.log(\"Review saved to database.\");\r\n            res.json(result);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n\r\n/*\r\nrouter.get(\"/:review/edit\", (req, res) => {\r\n    // Reviews Edit\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/reviews${req.url}`);\r\n\r\n    Books.findOne({_id: req.params.review})\r\n        .then(review => {\r\n            res.json(review);\r\n        })\r\n        .catch(error => {\r\n            console.error(error);\r\n            res.send(error);\r\n        });\r\n});\r\n*/\r\n\r\nrouter.put(\"/:review\", (req, res) => {\r\n    // Review Update\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/reviews${req.url}`);\r\n\r\n    if (!req.body.stars || !req.body.commentary) {\r\n        console.log(\"Missing informations to update review\");\r\n        res.send(\"Missing informations to update review\");\r\n        return;\r\n    }\r\n\r\n    const review = {\r\n        stars: req.body.stars,\r\n        commentary: req.body.commentary,\r\n        updated_at: Date.now(),\r\n    };\r\n\r\n    const options = {\r\n        new: true,\r\n    };\r\n\r\n    Reviews.findOneAndUpdate(\r\n        {_id: req.params.review},\r\n        review,\r\n        options,\r\n        (error, result) => {\r\n            if (error) {\r\n                console.error(error);\r\n                res.send(error);\r\n                return;\r\n            }\r\n            console.log(\"Review updated in database\");\r\n            res.json(result);\r\n        },\r\n    );\r\n});\r\n\r\nrouter.delete(\"/:review\", (req, res) => {\r\n    // Reviews Delete\r\n    console.log(`ℹ️  (${req.method.toUpperCase()}) /api/reviews${req.url}`);\r\n\r\n    Reviews.findOneAndDelete({_id: req.params.review}, (error, result) => {\r\n        if (error) {\r\n            console.error(error);\r\n            res.send(error);\r\n            return;\r\n        }\r\n\r\n        if (result === null) {\r\n            console.error(\"Review not found\");\r\n            res.send(\"Review not found\");\r\n            return;\r\n        }\r\n\r\n        console.log(\"Review deleted from database\");\r\n        res.send(\"Review deleted from database\");\r\n    });\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"reviews.js"}